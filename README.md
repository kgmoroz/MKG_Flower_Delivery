# FlowerDelivery

**Универсальная платформа для заказа и управления доставкой цветов через веб‑интерфейс и Telegram‑бота.**

---

## Содержание

* [Концепция и описание](#концепция-и-описание)
* [Функциональные возможности](#функциональные-возможности)
* [Архитектура и структура проекта](#архитектура-и-структура-проекта)
* [Технологический стек](#технологический-стек)
* [Установка и настройка](#установка-и-настройка)
* [Конфигурационные параметры](#конфигурационные-параметры)
* [Запуск приложения](#запуск-приложения)
* [Использование](#использование)
* [Тестирование](#тестирование)
* [Вклад и расширение](#вклад-и-расширение)
* [Контакты и поддержка](#контакты-и-поддержка)

---

## Концепция и описание

FlowerDelivery — это веб‑приложение для оформления заказов на доставку цветов. Платформа сочетает в себе:

1. **Интернет-магазин** с каталогом цветочных композиций.
2. **Корзину**, позволяющую выбирать количество каждого товара.
3. **Процесс оформления заказа** с указанием даты, времени и адреса доставки.
4. **Личный кабинет** пользователя с историей и повторением заказов.
5. **Административный интерфейс** для управления заказами и смены их статусов.
6. **Telegram‑бот**, оповещающий владельца магазина о новых заказах и изменении их статусов.

---

## Функциональные возможности

### 1. Пользовательская часть

* Регистрация и аутентификация (включая дополнительные поля: имя, фамилия, email, телефон, адрес).
* Просмотр каталога доступных цветов (фотографии, названия, цены).
* Выбор количества каждого товара и добавление в корзину.
* Обновление корзины: изменение количества, удаление позиций, очистка корзины.
* Оформление заказа:

  * Выбор даты и времени доставки через календарь и тайм‑пикер.
  * Автозаполнение адреса по данным профиля.
  * Проверка доступности заказа только в рабочие часы (Пн–Пт, 09:00–18:00).
* Страница подтверждения и благодарности (`thank_you`).
* Личный кабинет с историей заказов:

  * Аккордеон с деталями прошлых заказов (список товаров, статусы).
  * Кнопка «Повторить», переносящая в корзину.

### 2. Административная часть

* Стандартная админка Django для моделей `Order` и `OrderItem`.
* Специальная панель управления заказами для сотрудников (staff):

  * Просмотр списка всех заказов.
  * Смена статуса заказа через кнопки «В работе», «В доставке», «Выполнен».

### 3. Telegram‑бот

* Отправка уведомления о новом заказе с деталями по каждому товару, общей суммой, датой и адресом.
* Отправка сообщения об обновлении статуса заказа с указанием имени клиента в формате **Имя Фамилия (username)**.
* Обработка ошибок отправки — логирование в консоль без падения основного приложения.

---

## Архитектура и структура проекта

```
MKG_Flower_Delivery/
├── catalog/             # Приложение каталога и логики корзины
│   ├── cart_utils.py    # Сериализация/десериализация корзины в сессии
│   ├── models.py        # Модель Product
│   ├── views.py         # Логика отображения каталога и корзины
│   ├── urls.py
│   └── tests/           # Unit- и интеграционные тесты для catalog
├── orders/              # Оформление и управление заказами
│   ├── models.py        # Модели Order, OrderItem
│   ├── views.py         # CheckoutForm, checkout, history, repeat, manage
│   ├── email_utils.py   # Отправка письма клиенту
│   ├── urls.py
│   └── tests/           # Unit- и интеграционные тесты для orders
├── users/               # Пользователи и регистрация
│   ├── forms.py         # CustomUserCreationForm
│   ├── views.py         # signup_view
│   ├── models.py        # CustomUser (если есть)
│   ├── urls.py
│   └── tests/           # Unit- и интеграционные тесты для users
├── bot/                 # Утилиты работы с Telegram Bot API
│   └── utils.py         # send_new_order_notification, send_order_status_update
├── templates/           # Все HTML-шаблоны (base, catalog, orders, emails…)
├── static/              # CSS, JS, изображения (placeholder, стили)
├── .env                 # Переменные среды (не в репо)
├── requirements.txt
└── manage.py
```

---

## Технологический стек

* Python 3.12
* Django 5.2
* Bootstrap 5.3 (CDN)
* `django-environ` для работы с файлом `.env`
* `python-telegram-bot` для интеграции с Telegram API
* СУБД: SQLite (по умолчанию) или PostgreSQL (при настройке `DATABASE_URL`)
* Тестирование: `pytest`, `pytest-django`
* Формы и стилизация: `django-crispy-forms`, `crispy-bootstrap5`

---

## Установка и настройка

1. **Клонирование и переход в директорию**:

   ```bash
   git clone https://github.com/kgmoroz/MKG_Flower_Delivery.git
   cd MKG_Flower_Delivery
   ```

2. **Создание виртуального окружения**:

   ```bash
   python -m venv .venv
   source .venv/bin/activate     # Linux/macOS
   .\.venv\Scripts\activate    # Windows
   ```

3. **Установка зависимостей**:

   ```bash
   pip install -r requirements.txt
   ```

4. \*\*Создание файла \*\***`.env`** (см. ниже раздел «Конфигурация»).

5. **Применение миграций**:

   ```bash
   python manage.py migrate
   ```

6. **Создание суперпользователя**:

   ```bash
   python manage.py createsuperuser
   ```

---

## Конфигурационные параметры

В корне проекта создайте файл `.env` со следующими переменными:

```dotenv
DJANGO_SECRET_KEY=ваш_секретный_ключ
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
DATABASE_URL=sqlite:///db.sqlite3   # либо ваша БД PostgreSQL

# Telegram Bot API
TELEGRAM_BOT_TOKEN=ваш_токен_бота
TELEGRAM_CHAT_ID=ID_чата_для_уведомлений

# Email
DEFAULT_FROM_EMAIL=no-reply@flowerdelivery.local
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend  # для разработки
```

---

## Запуск приложения

```bash
python manage.py runserver
```

Откройте в браузере: [http://127.0.0.1:8000/](http://127.0.0.1:8000/)

---

## Использование

1. **Регистрация и вход** через `/accounts/signup/` и `/accounts/login/`.
2. **Каталог**: просмотр и выбор цветов.
3. **Корзина**: настройка количества, удаление, очистка.
4. **Оформление заказа**: выбор даты/времени, адреса, подтверждение.
5. **История заказов** с возможностью повторного заказа.
6. **Администрирование**:

   * `/admin/` — стандартная админка Django.
   * `/orders/manage/` — панель управления заказами для staff.
7. **Telegram‑уведомления** приходят в указанный чат.

---

## Тестирование

* **Юнит-тесты**: запуск отдельных тестовых файлов.
* **Интеграционные тесты**: покрытие сценариев регистрации, корзины, оформления.

Запустить все тесты:

```bash
pytest -q
```

---

## Контакты и поддержка

**Автор:** Константин Мороз (@kgmoroz)

* Email: [kg\_moroz@mail.ru](mailto:kg_moroz@mail.ru)
* GitHub: [kgmoroz/MKG\_Flower\_Delivery](https://github.com/kgmoroz/MKG_Flower_Delivery)